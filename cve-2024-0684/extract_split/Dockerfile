FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    wget build-essential cmake automake autoconf \
    gettext autopoint bison git gperf texinfo rsync \
    libbenchmark-dev vim nano \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src
RUN git clone https://git.savannah.gnu.org/git/gnulib.git
RUN git clone https://git.savannah.gnu.org/git/coreutils.git && \
    cd coreutils && \
    git checkout 445f502839b6b13d051612e989a02a36f8b9176e

WORKDIR /usr/src/coreutils
RUN ./bootstrap
RUN FORCE_UNSAFE_CONFIGURE=1 ./configure

# Extract split.c for editing
RUN cp src/split.c /tmp/split.c

CMD ["/bin/bash"]