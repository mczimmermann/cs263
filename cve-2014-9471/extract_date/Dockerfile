FROM ubuntu:14.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    wget build-essential \
    vim nano \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src

# Download coreutils 8.2 which is vulnerable to CVE-2015-4042
RUN wget https://ftp.gnu.org/gnu/coreutils/coreutils-8.2.tar.xz && \
    tar -xf coreutils-8.2.tar.xz && \
    rm coreutils-8.2.tar.xz

WORKDIR /usr/src/coreutils-8.2

RUN FORCE_UNSAFE_CONFIGURE=1 ./configure
RUN make

# Extract date.c for editing
RUN cp src/date.c /tmp/date.c

# Also copy to /output for easy extraction
RUN mkdir -p /output && cp src/date.c /output/date.c

CMD ["/bin/bash"]